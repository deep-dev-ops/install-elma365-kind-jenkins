# Jenkins скрипт для автоматизированной установки ELMA365 KinD

# Применение
Можно использовать для автоматической установки чистых ELMA365 KinD для разработчиков (им только дать доступ к Jenkins) для целей тестирования разработок или иного. Используя автоматизированное развертывание ELMA365 KinD, в совокупности с IaC подходом управления ВМ, а также с CI/CD пайплайнами для сборки и деплоя собственных модулей можно предоставить быстрый и красивый способ создания тестовых окружений с простым для разработчиков управлением без необходимости ввода ручных команд в терминале для установки платформы ELMA365 или машин.

# Требования
1) Наличие Jenkins и базовых навыков его использования
2) На машине, куда будет производится установка необходимо:
- Обеспечить возможност ssh подключения от Jenkins к машине, где будет установлена ELMA365 KinD
- Установить на машине (где будет установлена ELMA365 KinD) docker (например согласно официальной инструкции https://docs.docker.com/engine/install/) и curl

# Как пользоваться скриптом:
1) Необходимо клонировать репозиторий
2) Внести при необходимости изменения в Jenkinsfile (как минимум в раздел parameters с указанием IP своего узла и в stage 2 в команду создания config-elma365)
3) Создать в Jenkins "New item" с типом "Pipeline"
4) В Configuration/Настройках нового item в разделе "Pipeline"/"Definition" выбрать "Pipeline script from SCM". В подтипе "SCM" выбрать "Git" и подключить свой репозиторий 

> Обратите, пожалуйста, внимание: Подключения репозитория будет требовать авторизацию. Например, можно сделать следующим образом через SSH key авторизацию:
> 1) Снегенерировать SSH-ключ с публичным и приватным keys
> 2) Добавить публичный key в Github (Github -> Setting -> Deploy keys либо сделать это согласно документации Вашей Git-системы)
> 3) Создать credentials в Jenkins с закрытым key типа "SSH Username with private key", после чего использовать созданный credentials для авторизации в Github. 

5) Запустить сборку item в Jenkins

# Нюансы применения
- В примерном проекте используется авторизация с withCredentials (создается также через credentials в Jenkins типа "Username with password"). Предварительно нужно на удаленном сервере, куда будет производится установка ELMA365, настроить ssh агента на возможность авторизации и возможность повышения привилегий через sudo. Вы можете переделать pipeline на другой тип авторизации для Ваших целей и политик или использовать изолированные децентрализованные сборки для безопасности и vault хранения секретов и убрать все компроментирующие комментарии с выводом в console job чувствительной информации.

- Из-за особенностей лицензирования продукта ELMA365, настроить автоматическую активацию даже пробного периода не представляется возможным. Для этого стоит предусмотреть после установки процесс, который будет вручную выполнять сотрудник с правами запроса ключей активации и будет активировать только что установленные платформы. Каждая установка ELMA365 с точки зрения инфраструктуры является отдельным продуктом и требует отдельного лицензирования со своим ключом активации.
